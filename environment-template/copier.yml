# ------------------
#   Environment Setup
# ------------------

local_environment_name:
  type: str
  help: Environment name used for the cluster folder (e.g., api, staging, prod, ltv).
  default: api

# -------------------
#   Project Foundation
# -------------------

project_id:
  type: str
  help: Name of the google project id
  validator: "{% if not project_id %}project_id is required{% endif %}"

region:
  type: str
  help: GCP region for regional resources (e.g., us-west1).
  validator: "{% if not region %}region is required{% elif not region | regex_search('^[a-z]+-[a-z]+[0-9]+$') %}region must be in GCP format (e.g., us-west1){% endif %}"

zone:
  type: str
  help: GCP zone used in kube context and defaults (e.g., us-west1-b).
  default: "{{ region }}-a"
  validator: "{% if not zone %}zone is required{% elif not zone | regex_search('^[a-z]+-[a-z]+[0-9]+-[a-z]$') %}zone must be in GCP format (e.g., us-west1-b){% endif %}"

owner:
  type: str
  help: "Text label used as prefix for computational resources; helpful for cost filtering."
  default: cave

# ----------------
#   User & Access
# ----------------

gcp_user_account:
  type: str
  help: An email address that has google account permissions in the GCP project. Used to give GCP resources permissions and for letsencrypt certificates.
  validator: "{% if not gcp_user_account %}gcp_user_account is required{% elif '@' not in gcp_user_account %}gcp_user_account must be a valid email address{% endif %}"

# ---------------------
#   Core Infrastructure
# ---------------------

state_bucket:
  type: str
  help: Name of GCP bucket to store terraform and terragrunt states. Must omit the gs:// prefix.
  validator: "{% if not state_bucket %}state_bucket is required{% elif 'gs://' in state_bucket %}Invalid format — omit gs://{% endif %}"

domain_name:
  type: str
  help: Base domain without protocols (e.g., example.org).
  validator: "{% if not domain_name %}domain_name is required{% elif domain_name.startswith('http') %}Invalid format — omit protocol (http/https){% endif %}"

dns_zone:
  type: str
  help: "Cloud DNS managed zone name (e.g., em)."
  default: cave

vpc_name_override:
  type: str
  help: Optional — existing VPC name to use instead of newly generated

docker_registry:
  type: str
  help: Container registry for images. The default docker.io/caveconnectome is likely correct.
  default: docker.io/caveconnectome

# --------------
#   Data Storage
# --------------

local_sql_instance_name:
  type: str
  help: "Cloud SQL Postgres instance name. If migrating existing data, lookup the name you have already used."
  default: "cave-{{ local_environment_name }}"

bigtable_instance_name:
  type: str
  help: Bigtable instance name for PyChunkedGraph. Default is fine.
  default: pychunkedgraph

bigtable_google_project:
  type: str
  help: "Optional: If your PCG bigtable instance is in another project, the name of that project. Otherwise leave blank."

pcg_bucket_name:
  type: str
  help: The name of the bucket you set up to store PyChunkedGraph data.
  validator: "{% if not pcg_bucket_name %}pcg_bucket_name is required{% endif %}"

# --------------------
#   Application Config
# --------------------

global_server:
  type: str
  help: URL of the global cluster without protocols.
  default: "global.{{ domain_name }}"

health_annotation_align_volume:
  type: str
  help: An aligned volume name that will be used by the Annotation service for the liveliness probe
  validator: "{% if not health_annotation_align_volume %}health_annotation_align_volume is required{% endif %}"

# ----------
#   Security
# ----------

cave_secret_name:
  type: str
  help: Name of the Google Secret Manager secret containing the CAVE token. You must manually create this secret in Google Secret Manager before running terraform.
  default: "{{ local_environment_name }}-cave-token"

letsencrypt_email:
  type: str
  help: "Email for Let's Encrypt certificates. Defaults to your gcp_user_account value."
  default: "{{ gcp_user_account }}"

# --------------------
#   Optional Overrides
# --------------------

pcg_redis_name_override:
  type: str
  help: "Optional: Name of redis instance to store PCG meshing cache data. Default will name it based on cluster_prefix."

skeleton_cache_cloudpath:
  type: str
  help: "Optional: if you have already setup a skeleton cache bucket, name of the path to that bucket. Note you need to uncomment this in the root.hcl file to utilize"
  validator: "{% if skeleton_cache_cloudpath and 'gs://' in skeleton_cache_cloudpath %}Invalid format — omit gs://{% endif %}"

pcg_skeleton_cache_bucket_public_read:
  type: bool
  help: "Optional: should the skeleton cache bucket be publicly readable. If true, you need to uncomment in the root.hcl file"
  default: false

materialization_dump_bucket_name:
  type: str
  help: "Optional: GCS bucket name for materialization dumps. Leave blank if not needed."
  validator: "{% if materialization_dump_bucket_name and 'gs://' in materialization_dump_bucket_name %}Invalid format — omit gs://{% endif %}"

materialization_upload_bucket_name:
  type: str
  help: "Optional: GCS bucket name for materialization uploads. Leave blank if not needed."
  validator: "{% if materialization_upload_bucket_name and 'gs://' in materialization_upload_bucket_name %}Invalid format — omit gs://{% endif %}"

